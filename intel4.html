<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Threat Intelligence Daily Briefing</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #00d4ff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: #a0a0a0;
            font-size: 1.1em;
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        button {
            padding: 12px 24px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .status {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            display: none;
        }

        .status.active {
            display: block;
        }

        .status.loading {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }

        .status.success {
            background: rgba(40, 167, 69, 0.2);
            color: #28a745;
        }

        .status.error {
            background: rgba(220, 53, 69, 0.2);
            color: #dc3545;
        }

        .briefing {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: none;
        }

        .briefing.active {
            display: block;
        }

        .section {
            margin-bottom: 35px;
        }

        .section-title {
            font-size: 1.4em;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-icon {
            width: 24px;
            height: 24px;
            display: inline-block;
        }

        .item {
            background: rgba(255, 255, 255, 0.03);
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 8px;
            border-left: 3px solid #667eea;
            transition: all 0.3s ease;
        }

        .item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(5px);
        }

        .item-title {
            font-size: 1.05em;
            margin-bottom: 8px;
            color: #ffffff;
        }

        .item-sources {
            font-size: 0.85em;
            color: #a0a0a0;
        }

        .item-sources a {
            color: #667eea;
            text-decoration: none;
            margin-right: 10px;
            transition: color 0.3s ease;
        }

        .item-sources a:hover {
            color: #00d4ff;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px 20px;
            border-radius: 8px;
            flex: 1;
            min-width: 150px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #00d4ff;
        }

        .stat-label {
            font-size: 0.9em;
            color: #a0a0a0;
            margin-top: 5px;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
            }
            
            .controls {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Threat Intelligence Daily Briefing</h1>
            <div class="subtitle">Consolidated security news from 30+ sources</div>
        </header>

        <div class="controls">
            <button id="fetchBtn" onclick="fetchAndProcess()">
                <span id="btnText">Generate Briefing</span>
            </button>
            <button onclick="clearBriefing()">Clear</button>
            <button onclick="exportBriefing()">Export</button>
        </div>

        <div id="status" class="status"></div>

        <div id="stats" class="stats" style="display: none;">
            <div class="stat-card">
                <div class="stat-value" id="totalArticles">0</div>
                <div class="stat-label">Total Articles</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="uniqueEvents">0</div>
                <div class="stat-label">Unique Events</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="sourcesCount">0</div>
                <div class="stat-label">Sources</div>
            </div>
        </div>

        <div id="briefing" class="briefing">
            <div class="empty-state">
                <div class="empty-state-icon">üì°</div>
                <h3>No briefing available</h3>
                <p>Click "Generate Briefing" to fetch the latest threat intelligence</p>
            </div>
        </div>
    </div>

    <script>
        const RSS_SOURCES = [
            { name: 'BleepingComputer', url: 'https://www.bleepingcomputer.com/feed/' },
            { name: 'SecurityWeek', url: 'http://feeds.feedburner.com/Securityweek' },
            { name: 'The Hacker News', url: 'https://feeds.feedburner.com/TheHackersNews' },
            { name: 'Schneier on Security', url: 'https://www.schneier.com/feed/atom/' },
            { name: 'Dark Reading', url: 'https://www.darkreading.com/rss.xml' },
            { name: 'Kaspersky Securelist', url: 'http://www.securelist.com/en/rss/allupdates' },
            { name: 'Mandiant Blog', url: 'https://www.mandiant.com/resources/blog/rss.xml' },
            { name: 'Microsoft Security Blog', url: 'https://www.microsoft.com/en-us/security/blog/feed/' },
            { name: 'Trend Micro Simply Security', url: 'http://feeds.trendmicro.com/TrendMicroSimplySecurity' },
            { name: 'Recorded Future', url: 'https://www.recordedfuture.com/feed/' },
            { name: 'The DFIR Report', url: 'https://thedfirreport.com/feed/' },
            { name: 'Sophos News', url: 'https://news.sophos.com/en-us/feed' },
            { name: 'Check Point Research', url: 'https://research.checkpoint.com/feed' },
            { name: 'Cisco Talos', url: 'https://blog.talosintelligence.com/rss/' },
            { name: 'CloudSEK Blog', url: 'https://www.cloudsek.com/blog/rss.xml' },
            { name: 'Coveware Blog', url: 'https://www.coveware.com/blog?format=RSS' },
            { name: 'ESET Blog', url: 'https://feeds.feedburner.com/eset/blog?format=xml' },
            { name: 'Eye Security Blog', url: 'https://www.eye.security/blog/rss.xml' },
            { name: 'Fox-IT Blog', url: 'http://blog.fox-it.com/feed/' },
            { name: 'Google Project Zero', url: 'http://googleprojectzero.blogspot.com/feeds/posts/default' },
            { name: 'Google Threat Analysis Group', url: 'https://blog.google/threat-analysis-group/rss' },
            { name: 'Huntress Blog', url: 'https://www.huntress.com/blog/rss.xml' },
            { name: 'DoublePulsar', url: 'https://doublepulsar.com/feed' },
            { name: 'Proofpoint Threat Insight', url: 'https://www.proofpoint.com/us/threat-insight-blog.xml' },
            { name: 'Rapid7 Detection and Response', url: 'https://blog.rapid7.com/tag/detection-and-response/rss/' },
            { name: 'SentinelOne Labs', url: 'https://labs.sentinelone.com/feed/' },
            { name: 'Unit42', url: 'http://feeds.feedburner.com/Unit42' },
            { name: 'WatchTowr Labs', url: 'https://labs.watchtowr.com/rss/' },
            { name: 'Wiz Blog', url: 'https://blog.wiz.io/rss/' },
            { name: 'Zscaler Research', url: 'http://research.zscaler.com/feeds/posts/default' },
            { name: 'Crowdstrike', url: 'https://www.crowdstrike.com/blog/feed' }
        ];

        const CORS_PROXY = 'https://api.allorigins.win/raw?url=';
        
        let allArticles = [];
        let processedBriefing = null;

        async function fetchRSS(url) {
            try {
                const response = await fetch(CORS_PROXY + encodeURIComponent(url));
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const text = await response.text();
                return parseRSS(text);
            } catch (error) {
                console.error(`Error fetching ${url}:`, error);
                return [];
            }
        }

        function parseRSS(xmlText) {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xmlText, 'text/xml');
            const items = xmlDoc.querySelectorAll('item, entry');
            const articles = [];

            items.forEach(item => {
                const title = item.querySelector('title')?.textContent || '';
                const link = item.querySelector('link')?.textContent || 
                           item.querySelector('link[href]')?.getAttribute('href') || '';
                const description = item.querySelector('description')?.textContent || 
                                  item.querySelector('summary')?.textContent || '';
                const pubDate = item.querySelector('pubDate')?.textContent || 
                              item.querySelector('published')?.textContent || '';

                if (title && link) {
                    articles.push({
                        title: title.trim(),
                        link: link.trim(),
                        description: description.trim(),
                        pubDate: new Date(pubDate)
                    });
                }
            });

            return articles;
        }

        function categorizeArticle(article) {
            const title = article.title.toLowerCase();
            const desc = article.description.toLowerCase();
            const content = (title + ' ' + desc).toLowerCase();

            // Nation state indicators
            const nationStateKeywords = ['apt', 'nation state', 'state-sponsored', 'china', 'russia', 'iran', 'north korea', 'lazarus', 'cozy bear', 'fancy bear'];
            
            // Financially motivated indicators
            const financialKeywords = ['ransomware', 'extortion', 'cryptocurrency', 'bitcoin', 'monero', 'payment', 'financial', 'banking', 'fraud'];
            
            // Data breach indicators
            const breachKeywords = ['breach', 'leak', 'exposed', 'compromised', 'data breach', 'personal data', 'customer data'];
            
            // Vulnerability indicators
            const vulnKeywords = ['cve-', 'vulnerability', 'exploit', 'patch', 'zero-day', 'flaw', 'bug', 'security update'];

            if (nationStateKeywords.some(k => content.includes(k))) {
                return 'nation-state';
            } else if (financialKeywords.some(k => content.includes(k))) {
                return 'financial';
            } else if (breachKeywords.some(k => content.includes(k))) {
                return 'breach';
            } else if (vulnKeywords.some(k => content.includes(k))) {
                return 'vulnerability';
            } else if (content.includes('malware') || content.includes('trojan') || content.includes('botnet')) {
                return 'malware';
            }
            
            return 'other';
        }

        function extractKeyInfo(article) {
            // Extract CVE numbers
            const cveMatches = article.title.match(/CVE-\d{4}-\d{4,7}/gi) || [];
            
            // Extract victim names for breaches
            const victimMatches = article.title.match(/([A-Z][a-z]+(?:\s+[A-Z][a-z]+)*)\s+(breached|compromised|hacked|attacked)/gi) || [];
            
            // Extract actor names
            const actorMatches = article.title.match(/(APT\d+|Lazarus|Cozy Bear|Fancy Bear|TA\d+)/gi) || [];
            
            return {
                cves: cveMatches,
                victims: victimMatches,
                actors: actorMatches
            };
        }

        function deduplicateArticles(articles) {
            const seen = new Map();
            const deduped = [];

            articles.forEach(article => {
                const key = article.title.toLowerCase().replace(/[^a-z0-9]/g, '');
                if (!seen.has(key)) {
                    seen.set(key, article);
                    article.sources = [article.source];
                    deduped.push(article);
                } else {
                    const existing = seen.get(key);
                    if (!existing.sources.includes(article.source)) {
                        existing.sources.push(article.source);
                    }
                }
            });

            return deduped;
        }

        function generateBriefing(articles) {
            const categorized = {
                'nation-state': [],
                'financial': [],
                'breach': [],
                'vulnerability': [],
                'malware': [],
                'other': []
            };

            articles.forEach(article => {
                const category = categorizeArticle(article);
                article.category = category;
                categorized[category].push(article);
            });

            // Sort by frequency and relevance
            Object.keys(categorized).forEach(key => {
                categorized[key].sort((a, b) => {
                    // Prioritize articles with more sources
                    if (b.sources.length !== a.sources.length) {
                        return b.sources.length - a.sources.length;
                    }
                    // Then by recency
                    return b.pubDate - a.pubDate;
                });
            });

            return categorized;
        }

        function renderBriefing(briefing) {
            const briefingEl = document.getElementById('briefing');
            const statsEl = document.getElementById('stats');
            
            let html = '';
            let totalEvents = 0;
            let sources = new Set();

            const sections = [
                { key: 'nation-state', title: 'üéØ Nation State Actor Activity', icon: 'üåç' },
                { key: 'financial', title: 'üí∞ Financially Motivated Actor Activity', icon: 'üí∏' },
                { key: 'breach', title: 'üö® Compromises and Data Breach Activity', icon: 'üîì' },
                { key: 'vulnerability', title: 'üõ°Ô∏è Vulnerabilities Activity', icon: '‚ö†Ô∏è' },
                { key: 'malware', title: 'ü¶† Malware Activity', icon: 'üêõ' },
                { key: 'other', title: 'üìã Other Security Activity', icon: 'üì∞' }
            ];

            sections.forEach(section => {
                const items = briefing[section.key];
                if (items.length > 0) {
                    totalEvents += items.length;
                    html += `<div class="section">
                        <h2 class="section-title">
                            <span class="section-icon">${section.icon}</span>
                            ${section.title}
                        </h2>`;
                    
                    // Show top 5-7 items per category
                    items.slice(0, 7).forEach(item => {
                        item.sources.forEach(s => sources.add(s));
                        const keyInfo = extractKeyInfo(item);
                        let title = item.title;
                        
                        // Keep titles concise
                        if (title.length > 100) {
                            title = title.substring(0, 97) + '...';
                        }
                        
                        html += `<div class="item">
                            <div class="item-title">${title}</div>
                            <div class="item-sources">
                                ${item.sources.map(s => `<a href="${item.link}" target="_blank">${s}</a>`).join('')}
                            </div>
                        </div>`;
                    });
                    
                    html += '</div>';
                }
            });

            if (html) {
                briefingEl.innerHTML = html;
                statsEl.style.display = 'flex';
                document.getElementById('totalArticles').textContent = allArticles.length;
                document.getElementById('uniqueEvents').textContent = totalEvents;
                document.getElementById('sourcesCount').textContent = sources.size;
            } else {
                briefingEl.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üîç</div>
                        <h3>No relevant threats found</h3>
                        <p>Try fetching again later for the latest updates</p>
                    </div>`;
            }
        }

        async function fetchAndProcess() {
            const btn = document.getElementById('fetchBtn');
            const btnText = document.getElementById('btnText');
            const status = document.getElementById('status');
            
            btn.disabled = true;
            btnText.innerHTML = '<span class="loading-spinner"></span> Fetching...';
            
            status.className = 'status loading active';
            status.textContent = 'Fetching RSS feeds from 30+ sources...';
            
            allArticles = [];
            let successCount = 0;
            
            try {
                // Fetch all RSS feeds
                const fetchPromises = RSS_SOURCES.map(async (source) => {
                    const articles = await fetchRSS(source.url);
                    if (articles.length > 0) {
                        successCount++;
                        articles.forEach(article => {
                            article.source = source.name;
                        });
                        return articles;
                    }
                    return [];
                });
                
                const results = await Promise.all(fetchPromises);
                allArticles = results.flat();
                
                status.textContent = `Processing ${allArticles.length} articles from ${successCount} sources...`;
                
                // Sort by date
                allArticles.sort((a, b) => b.pubDate - a.pubDate);
                
                // Deduplicate and categorize
                const deduped = deduplicateArticles(allArticles);
                processedBriefing = generateBriefing(deduped);
                
                // Render the briefing
                renderBriefing(processedBriefing);
                
                document.getElementById('briefing').classList.add('active');
                
                status.className = 'status success active';
                status.textContent = `Successfully generated briefing from ${successCount} sources (${allArticles.length} articles)`;
                
                setTimeout(() => {
                    status.classList.remove('active');
                }, 5000);
                
            } catch (error) {
                console.error('Error:', error);
                status.className = 'status error active';
                status.textContent = 'Error fetching feeds. Please try again.';
            } finally {
                btn.disabled = false;
                btnText.textContent = 'Generate Briefing';
            }
        }

        function clearBriefing() {
            document.getElementById('briefing').classList.remove('active');
            document.getElementById('stats').style.display = 'none';
            document.getElementById('status').classList.remove('active');
            allArticles = [];
            processedBriefing = null;
        }

        function exportBriefing() {
            if (!processedBriefing) {
                alert('Please generate a briefing first');
                return;
            }
            
            let text = 'THREAT INTELLIGENCE DAILY BRIEFING\n';
            text += '=' .repeat(50) + '\n\n';
            text += `Generated: ${new Date().toLocaleString()}\n\n`;
            
            const sections = [
                { key: 'nation-state', title: 'NATION STATE ACTOR ACTIVITY' },
                { key: 'financial', title: 'FINANCIALLY MOTIVATED ACTOR ACTIVITY' },
                { key: 'breach', title: 'COMPROMISES AND DATA BREACH ACTIVITY' },
                { key: 'vulnerability', title: 'VULNERABILITIES ACTIVITY' },
                { key: 'malware', title: 'MALWARE ACTIVITY' },
                { key: 'other', title: 'OTHER SECURITY ACTIVITY' }
            ];
            
            sections.forEach(section => {
                const items = processedBriefing[section.key];
                if (items.length > 0) {
                    text += `${section.title}\n`;
                    text += '-'.repeat(30) + '\n';
                    items.slice(0, 7).forEach(item => {
                        text += `‚Ä¢ ${item.title}\n`;
                        text += `  Sources: ${item.sources.join(', ')}\n\n`;
                    });
                    text += '\n';
                }
            });
            
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `threat-briefing-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Auto-refresh every 30 minutes
        setInterval(() => {
            if (document.getElementById('briefing').classList.contains('active')) {
                fetchAndProcess();
            }
        }, 30 * 60 * 1000);
    </script>
</body>
</html>
